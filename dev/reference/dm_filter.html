<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Filtering — dm_filter • dm</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Filtering — dm_filter" />
<meta property="og:description" content="
Filtering a table of a dm object may affect other tables that are connected to it
directly or indirectly via foreign key relations.
dm_filter() can be used to define filter conditions for tables using syntax that is similar to dplyr::filter().
These conditions will be stored in the dm, and executed immediately for the tables that they are referring to.
With dm_apply_filters(), all tables will be updated according to the filter conditions and the foreign key relations.
dm_apply_filters_to_tbl() retrieves one specific table of the dm that is updated according to the filter conditions and the foreign key relations." />
<meta property="og:image" content="https://krlmlr.github.io/dm/logo.png" />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="cynkra-logo-font" href="https://www.cynkra.com">cynkra</a>
        <a class="cynkra-logo" href="https://www.cynkra.com">&#9632;</a>
        <a class="navbar-brand" href="../index.html">dm <small>v0.1.2.9000</small></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-left">
        <li>
  <a href="https://pat-s.github.io/dm/index.html">release</a>
</li>
<li>
  <a href="https://pat-s.github.io/dm/dev/index.html">devel</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Intro
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dm.html">Intro</a>
    </li>
    <li>
      <a href="../reference/index.html">Reference</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dm-db.html">Connect to a database</a>
    </li>
    <li>
      <a href="../articles/dm-df.html">Create a dm object from data frames</a>
    </li>
    <li>
      <a href="../articles/dm-introduction-relational-data-models.html">Introduction to relational data models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Technical articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dm-class-and-basic-operations.html">Class 'dm' and basic operations</a>
    </li>
    <li>
      <a href="../articles/dm-visualization.html">Visualizing dm objects</a>
    </li>
    <li>
      <a href="../articles/dm-joining.html">Joining in relational data models</a>
    </li>
    <li>
      <a href="../articles/dm-zoom-to-table.html">Zooming and manipulating tables</a>
    </li>
    <li>
      <a href="../articles/dm-filtering.html">Filtering in relational data models</a>
    </li>
    <li>
      <a href="../articles/dm-low-level.html">Checking keys</a>
    </li>
    <li>
      <a href="../articles/dm-function-naming-logic.html">Function naming logic</a>
    </li>
    <li>
      <a href="../articles/dm-version-migration-guide.html">Migration guide: 'cdm' -&gt; 'dm'</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/krlmlr/dm/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Filtering</h1>
    <small class="dont-index">Source: <a href='https://github.com/krlmlr/dm/blob/master/R/filter-dm.R'><code>R/filter-dm.R</code></a></small>
    <div class="hidden name"><code>dm_filter.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><a href='https://www.tidyverse.org/lifecycle/#questioning'><img src='figures/lifecycle-questioning.svg' alt='Questioning lifecycle'></a></p>
<p>Filtering a table of a <code><a href='dm.html'>dm</a></code> object may affect other tables that are connected to it
directly or indirectly via foreign key relations.</p>
<p><code>dm_filter()</code> can be used to define filter conditions for tables using syntax that is similar to <code><a href='https://dplyr.tidyverse.org/reference/filter.html'>dplyr::filter()</a></code>.
These conditions will be stored in the <code><a href='dm.html'>dm</a></code>, and executed immediately for the tables that they are referring to.</p>
<p>With <code>dm_apply_filters()</code>, all tables will be updated according to the filter conditions and the foreign key relations.</p>
<p><code>dm_apply_filters_to_tbl()</code> retrieves one specific table of the <code>dm</code> that is updated according to the filter conditions and the foreign key relations.</p>
    </div>

    <pre class="usage"><span class='fu'>dm_filter</span>(<span class='no'>dm</span>, <span class='no'>table</span>, <span class='no'>...</span>)

<span class='fu'>dm_apply_filters</span>(<span class='no'>dm</span>)

<span class='fu'>dm_apply_filters_to_tbl</span>(<span class='no'>dm</span>, <span class='no'>table</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dm</th>
      <td><p>A <code>dm</code> object.</p></td>
    </tr>
    <tr>
      <th>table</th>
      <td><p>A table in the <code>dm</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Logical predicates defined in terms of the variables in <code>.data</code>, passed on to <code><a href='https://dplyr.tidyverse.org/reference/filter.html'>dplyr::filter()</a></code>.
Multiple conditions are combined with <code>&amp;</code> or <code>,</code>.
Only the rows where the condition evaluates
to <code>TRUE</code> are kept.</p>
<p>The arguments in ... are automatically quoted and evaluated in the context of
the data frame. They support unquoting and splicing.
See <code><a href='https://dplyr.tidyverse.org/articles/programming.html'>vignette("programming", package = "dplyr")</a></code>
for an introduction to these concepts.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>For <code>dm_filter()</code>: an updated <code>dm</code> object (filter executed for given table, and condition stored).</p>
<p>For <code>dm_apply_filters()</code>: an updated <code>dm</code> object (filter effects evaluated for all tables).</p>
<p>For <code>dm_apply_filters_to_tbl()</code>, a table.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The effect of the stored filter conditions on the tables related to the filtered ones is only evaluated
in one of the following scenarios:</p><ol>
<li><p>Calling <code>dm_apply_filters()</code> or <code><a href='https://dplyr.tidyverse.org/reference/compute.html'>compute()</a></code> (method for <code>dm</code> objects) on a <code>dm</code>: each filtered table potentially
reduces the rows of all other tables connected to it by foreign key relations (cascading effect), leaving only the rows
with corresponding key values.
Tables that are not connected to any table with an active filter are left unchanged.
This results in a new <code>dm</code> class object without any filter conditions.</p></li>
<li><p>Calling <code>dm_apply_filters_to_tbl()</code>: the remaining rows of the requested table are calculated by performing a sequence
of semi-joins (<code><a href='https://dplyr.tidyverse.org/reference/join.html'>dplyr::semi_join()</a></code>) starting from each table that has been filtered to the requested table
(similar to 1. but only for one table).</p></li>
</ol>

<p>Several functions of the dm package will throw an error if filter conditions exist when they are called.</p>
    <h2 class="hasAnchor" id="life-cycle"><a class="anchor" href="#life-cycle"></a>Life cycle</h2>

    

<p>These functions are marked "questioning" because it feels wrong
to tightly couple filtering with the data model.
On the one hand, an overview of active filters is useful
when specifying the base data set for an analysis in terms of column selections
and row filters.
However, these filter condition should be only of informative nature
and never affect the results of other operations.
We are working on formalizing the semantics of the underlying operations
in order to present them in a cleaner interface.</p>
<p>Use <code><a href='dm_zoom_to.html'>dm_zoom_to()</a></code> and <code><a href='https://dplyr.tidyverse.org/reference/filter.html'>dplyr::filter()</a></code> to filter rows without registering
the filter.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>dm_nyc</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='dm_nycflights13.html'>dm_nycflights13</a></span>()
<span class='no'>dm_nyc_filtered</span> <span class='kw'>&lt;-</span>
  <span class='fu'><a href='dm_nycflights13.html'>dm_nycflights13</a></span>() <span class='kw'>%&gt;%</span>
  <span class='fu'>dm_filter</span>(<span class='no'>airports</span>, <span class='no'>name</span> <span class='kw'>==</span> <span class='st'>"John F Kennedy Intl"</span>)

<span class='fu'>dm_apply_filters_to_tbl</span>(<span class='no'>dm_nyc_filtered</span>, <span class='no'>flights</span>)</div><div class='output co'>#&gt; # A tibble: 3,661 x 19
#&gt;     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;
#&gt;  1  2013     1    10        3           2359         4      426            437
#&gt;  2  2013     1    10       16           2359        17      447            444
#&gt;  3  2013     1    10      531            540        -9      832            850
#&gt;  4  2013     1    10      535            540        -5     1015           1017
#&gt;  5  2013     1    10      553            600        -7      711            715
#&gt;  6  2013     1    10      557            600        -3      855            912
#&gt;  7  2013     1    10      557            600        -3      933            925
#&gt;  8  2013     1    10      558            600        -2      844            906
#&gt;  9  2013     1    10      559            600        -1      653            658
#&gt; 10  2013     1    10      607            601         6      932            918
#&gt; # … with 3,651 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,
#&gt; #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
#&gt; #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</div><div class='input'>
<span class='no'>dm_nyc_filtered</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>dm_apply_filters</span>()</div><div class='output co'>#&gt; ── Table source ────────────────────────────────────────────────────────────────
#&gt; src:  &lt;environment: R_GlobalEnv&gt;
#&gt; ── Metadata ────────────────────────────────────────────────────────────────────
#&gt; Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
#&gt; Columns: 53
#&gt; Primary keys: 3
#&gt; Foreign keys: 3</div><div class='input'>
<span class='co'># If you want to keep only those rows in the parent tables</span>
<span class='co'># whose primary key values appear as foreign key values in</span>
<span class='co'># `flights`, you can set a `TRUE` filter in `flights`:</span>
<span class='no'>dm_nyc</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>dm_filter</span>(<span class='no'>flights</span>, <span class='fl'>1</span> <span class='kw'>==</span> <span class='fl'>1</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>dm_apply_filters</span>() <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='dm_nrow.html'>dm_nrow</a></span>()</div><div class='output co'>#&gt; airlines airports  flights   planes  weather 
#&gt;       16        3    11227     2345      861 </div><div class='input'><span class='co'># note that in this example, the only affected table is</span>
<span class='co'># `airports` because the departure airports in `flights` are</span>
<span class='co'># only the three New York airports.</span>

<span class='no'>dm_nyc</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>dm_filter</span>(<span class='no'>planes</span>, <span class='no'>engine</span> <span class='kw'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Reciprocating"</span>, <span class='st'>"4 Cycle"</span>)) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/compute.html'>compute</a></span>()</div><div class='output co'>#&gt; ── Table source ────────────────────────────────────────────────────────────────
#&gt; src:  &lt;environment: R_GlobalEnv&gt;
#&gt; ── Metadata ────────────────────────────────────────────────────────────────────
#&gt; Tables: `airlines`, `airports`, `flights`, `planes`, `weather`
#&gt; Columns: 53
#&gt; Primary keys: 3
#&gt; Foreign keys: 3</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="footer-left">
  <p>dm is sponsored by <a class="cynkra-logo-font-footer" href="https://www.cynkra.com">cynkra</a><a class="cynkra-logo-footer" href="https://www.cynkra.com">&#9632;</a>. Learn more at <a href="https://www.cynkra.com/">www.cynkra.com</a>.</p>
</div>

<div class="footer-right">
  <p>Developed by Tobias Schieferdecker, <a href='http://krlmlr.info'>Kirill Müller</a>, Darko Bergant, <a href='https://www.energie360.ch'><img src="https://krlmlr.github.io/dm/reference/figures/energie-72.png" height="16"/></a>, <a href='https://www.cynkra.com'><img src="https://krlmlr.github.io/dm/reference/figures/cynkra-72.png" height="16"/></a>.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


